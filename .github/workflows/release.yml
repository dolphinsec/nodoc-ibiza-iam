---
name: Release API definition

on:
  push:
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+'

permissions: {}

jobs:
  bundle:
    uses: dolphinsec/nodoc/.github/workflows/spec-build.yaml@main
    permissions:
      contents: read

  create-release:
    name: Create release
    needs: bundle
    uses: dolphinsec/nodoc/.github/workflows/spec-publish.yaml@main
    permissions:
      contents: write
    with:
      spec-artifact-id: '${{ needs.bundle.outputs.spec-artifact-name }}'
      stats-artifact-id: '${{ needs.bundle.outputs.stats-artifact-name }}'
      postman-api-version: '${{github.ref_name}}'
      api-root-path: 'specification/openapi.yml'
      release-tag: ${{ github.ref_name }}
      postman-api-id: ${{ vars.POSTMANAPIID }}
    secrets:
      postman-api-key: ${{ secrets.POSTMANAPIKEY }}
